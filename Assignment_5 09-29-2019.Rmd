---
title: "Assignment 5"
author: "Uliana Plotnikova"
date: "September 29, 2019"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---





```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
```


# Gather Data

###Treat empty columns as NA, while reading file as csv.


```{r}
Airlines <- read.csv("https://raw.githubusercontent.com/uplotnik/Data607/master/Airlines.csv", na.strings = c("", "NA"),
                    sep = ",", header = TRUE)

Airlines 
```
# Data Manipulation

###Change column names


```{r}
names(Airlines)[1] <- "Carrier"
names(Airlines)[2] <- "Flight_status"
Airlines
```
###Fill the NA's with the corresponding name


```{r}
Airlines <- Airlines %>% fill(Carrier)
Airlines
```


###Use 'gather' function to re-structure the table.
We can gather each city within one column variable and also gather the values associated with each city in a second column variable.

```{r}
Airlines <- Airlines %>% gather(City,  Number, Los.Angeles:Seattle)
head(Airlines)
```

### Spread "delayed"" and "on time" flights


```{r}
Airline <- spread(Airlines,"Flight_status", "Number")
head(Airline)
```

###Change column name "on time" with one word "Timely" 

(in order to avoid errors with future manipulations)


```{r}
Airline<- dplyr::rename(Airline, 'Timely'='on time')
Airline
```




# Data Analysis

### Find total average delayed flights by city


```{r}
## Ave delay for each city 
delay_avg <- Airline %>%
  group_by(City) %>%
summarise(Ave_City_Delay= round(mean(delayed, na.rm = TRUE), digits=5)) %>% 
 ##summarise(Ave_City_Timely= round(mean(Timely, na.rm = TRUE), digits=2))%>%
 arrange(.$Ave_City_Delay) 
delay_avg 
```

### Find total average flights arrived on time by city


```{r}

## Ave arrival on time for each city 

Timely_avg <- Airline %>%
  group_by(City) %>%
summarise(Ave_City_Timely= round(mean(Timely, na.rm = TRUE), digits=5)) %>%
  arrange(.$Ave_City_Timely)
Timely_avg 
```
### Join both tables by City

```{r}
City_tab <- left_join(delay_avg, Timely_avg, by = c('City'))%>%
  arrange(.$City)
City_tab

```


### Find average delayed flights for each Airline


```{r}
## Find average of delays for each Airline
delay_avg_carrier <- Airline %>%
  group_by(Carrier) %>%
summarise(Ave_delayed= round(mean(delayed, na.rm = TRUE), digits=2)) %>%
  arrange(.$Ave_delayed)
delay_avg_carrier 
```

### Find average flights arrived on time for each Airline


```{r}

timely_avg_carrier <- Airline %>%
  group_by(Carrier) %>%
summarise(Ave_timely= round(mean(Timely, na.rm = TRUE), digits=5)) %>%
  arrange(.$Ave_timely)
head(timely_avg_carrier) 
```

### Join both tables by "Carrier"

```{r}
Carrier1 <- left_join(delay_avg_carrier, timely_avg_carrier, by = c('Carrier'))%>%
  arrange(.$Carrier)
Carrier1
```

### Gather Ave_status

```{r}
Airlines1 <- Carrier1 %>% gather(Ave_status,  Flights, Ave_delayed:Ave_timely)
head(Airlines1)
```


#Vizualization


```{r}
ggplot(
  Airlines1, aes(x = Carrier, y = Flights,fill=Ave_status)) + 
  geom_bar(stat="identity") +
  ggtitle("Airlines: AVE DELAY vs AVE ON Time")+ 
  theme(axis.text=element_text(angle=90))+
  labs(x="City",y="Flights")
```



```{r}
ggplot(
  City_tab, aes(x = City, y = Ave_City_Timely ,fill=Ave_City_Timely)) + 
  geom_bar(stat="identity") +
  ggtitle("City: Ave ON TIME")+ 
  theme(axis.text=element_text(angle=90))+
  labs(x="City",y="Ave_City_Timely")

```


```{r echo=FALSE}
ggplot(
  City_tab, aes(x = City, y = Ave_City_Delay,fill=Ave_City_Delay)) + 
  geom_bar(stat="identity") +
  ggtitle("City: Ave DELAY")+ 
  theme(axis.text=element_text(angle=90))+
  labs(x="City",y="Ave_City_Delay")

```




